# âœ… CitrusLink å¯åŠ¨æ£€æŸ¥æ¸…å•

æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼Œç¡®ä¿ç³»ç»Ÿæ­£å¸¸è¿è¡Œã€‚

---

## ğŸ“‹ ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå‡†å¤‡

### 1.1 æ£€æŸ¥ Python ç‰ˆæœ¬
```bash
python3 --version
```
âœ… éœ€è¦ Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬

### 1.2 æ£€æŸ¥ PostgreSQL
```bash
psql --version
```
âœ… éœ€è¦ PostgreSQL 14 æˆ–æ›´é«˜ç‰ˆæœ¬

### 1.3 æ£€æŸ¥ PostgreSQL æœåŠ¡çŠ¶æ€
```bash
sudo systemctl status postgresql
```
âœ… æœåŠ¡åº”è¯¥æ˜¯ "active (running)"

å¦‚æœæœªè¿è¡Œï¼š
```bash
sudo systemctl start postgresql
```

---

## ğŸ“¦ ç¬¬äºŒæ­¥ï¼šå®‰è£…ä¾èµ–

### 2.1 å®‰è£… Python åŒ…
```bash
cd /home/anders/citrus_web_backend
pip3 install -r requirements.txt
```

### 2.2 éªŒè¯å®‰è£…
```bash
python3 -c "import fastapi, sqlalchemy, geoalchemy2, psycopg2; print('âœ… æ‰€æœ‰ä¾èµ–å·²å®‰è£…')"
```

---

## ğŸ—„ï¸ ç¬¬ä¸‰æ­¥ï¼šé…ç½®æ•°æ®åº“

### 3.1 åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰
```bash
sudo -u postgres psql << EOF
CREATE DATABASE citrus_link;
CREATE USER admin WITH PASSWORD 'citrus_pass';
GRANT ALL PRIVILEGES ON DATABASE citrus_link TO admin;
\c citrus_link
CREATE EXTENSION postgis;
\q
EOF
```

### 3.2 æµ‹è¯•æ•°æ®åº“è¿æ¥
```bash
python3 test_connection.py
```
âœ… åº”è¯¥çœ‹åˆ° "æ‰€æœ‰æµ‹è¯•é€šè¿‡"

---

## ğŸš€ ç¬¬å››æ­¥ï¼šåˆå§‹åŒ–æ•°æ®

### 4.1 ä¸€é”®åˆå§‹åŒ–ï¼ˆæ¨èï¼‰
```bash
python3 init_all.py
```

è¿™ä¸ªå‘½ä»¤ä¼šï¼š
- âœ… åˆ›å»ºæ‰€æœ‰æ•°æ®åº“è¡¨
- âœ… å¡«å……æµ‹è¯•æ•°æ®
- âœ… éªŒè¯æ•°æ®å®Œæ•´æ€§

### 4.2 æˆ–è€…åˆ†æ­¥æ‰§è¡Œ
```bash
python3 database_setup.py   # åˆ›å»ºè¡¨ç»“æ„
python3 populate_data.py    # å¡«å……æ•°æ®
python3 view_data.py        # æŸ¥çœ‹æ•°æ®
```

---

## ğŸŒ ç¬¬äº”æ­¥ï¼šå¯åŠ¨æœåŠ¡å™¨

### 5.1 å¯åŠ¨åç«¯æœåŠ¡
```bash
python3 main.py
```

çœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯è¡¨ç¤ºå¯åŠ¨æˆåŠŸï¼š
```
INFO:     Uvicorn running on http://0.0.0.0:8000
INFO:     Application startup complete.
```

### 5.2 æµ‹è¯• API
æ‰“å¼€æ–°ç»ˆç«¯ï¼Œæ‰§è¡Œï¼š
```bash
curl http://localhost:8000/api/dashboard/stats
```

åº”è¯¥è¿”å› JSON æ•°æ®ï¼š
```json
{
  "online_count": 1,
  "total_robots": 1,
  "task_rate": 0,
  "battery_avg": 85
}
```

---

## ğŸ¨ ç¬¬å…­æ­¥ï¼šè®¿é—®å‰ç«¯

### 6.1 æ‰“å¼€æµè§ˆå™¨
è®¿é—®: **http://localhost:8000**

### 6.2 éªŒè¯åŠŸèƒ½
- [ ] çœ‹åˆ° "CitrusLink æ™ºæ©˜äº‘æ§ Pro" æ ‡é¢˜
- [ ] å·¦ä¾§å¯¼èˆªæ æ­£å¸¸æ˜¾ç¤º
- [ ] å³ä¸Šè§’æ˜¾ç¤º "åœ¨çº¿è®¾å¤‡" ç»Ÿè®¡æ•°æ®
- [ ] åœ°å›¾ä¸Šæ˜¾ç¤ºæœºå™¨äººå›¾æ ‡å’Œæœå®å›¾æ ‡
- [ ] ç‚¹å‡» "ååŒä»»åŠ¡è°ƒåº¦" å¯ä»¥çœ‹åˆ°ä»»åŠ¡åˆ—è¡¨

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼špip install å¤±è´¥
```bash
pip3 install --upgrade pip
pip3 install -r requirements.txt --no-cache-dir
```

### é—®é¢˜ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ PostgreSQL
sudo systemctl status postgresql

# é‡å¯ PostgreSQL
sudo systemctl restart postgresql

# æµ‹è¯•è¿æ¥
psql -U admin -d citrus_link -h localhost
# å¯†ç : citrus_pass
```

### é—®é¢˜ï¼šPostGIS æ‰©å±•æœªå®‰è£…
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install postgis postgresql-14-postgis-3

# å¯ç”¨æ‰©å±•
sudo -u postgres psql -d citrus_link -c "CREATE EXTENSION IF NOT EXISTS postgis;"
```

### é—®é¢˜ï¼šç«¯å£ 8000 è¢«å ç”¨
```bash
# æŸ¥æ‰¾å ç”¨è¿›ç¨‹
sudo lsof -i :8000

# ç»ˆæ­¢è¿›ç¨‹
kill -9 <PID>

# æˆ–ä¿®æ”¹ main.py ä¸­çš„ç«¯å£å·
```

### é—®é¢˜ï¼šæƒé™ä¸è¶³
```bash
sudo -u postgres psql << EOF
GRANT ALL PRIVILEGES ON DATABASE citrus_link TO admin;
\c citrus_link
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO admin;
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO admin;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON TABLES TO admin;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON SEQUENCES TO admin;
EOF
```

---

## ğŸ“Š ç³»ç»ŸéªŒè¯æ¸…å•

è¿è¡Œå®Œæ‰€æœ‰æ­¥éª¤åï¼Œè¿›è¡Œæœ€ç»ˆéªŒè¯ï¼š

### åç«¯éªŒè¯
```bash
# æµ‹è¯•ç»Ÿè®¡ API
curl http://localhost:8000/api/dashboard/stats

# æµ‹è¯•ä»»åŠ¡ API
curl http://localhost:8000/api/tasks

# æµ‹è¯•åœ°å›¾ API
curl http://localhost:8000/api/map/objects
```

### å‰ç«¯éªŒè¯
- [ ] æµè§ˆå™¨è®¿é—® http://localhost:8000 æ­£å¸¸
- [ ] ä»ªè¡¨ç›˜æ˜¾ç¤ºç»Ÿè®¡æ•°æ®
- [ ] åœ°å›¾æ˜¾ç¤ºæœºå™¨äººå’Œæœå®
- [ ] ä»»åŠ¡åˆ—è¡¨é¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] é¡µé¢æ¯ 5 ç§’è‡ªåŠ¨åˆ·æ–°

### æ•°æ®åº“éªŒè¯
```bash
python3 view_data.py
```
åº”è¯¥çœ‹åˆ° 5 ä¸ªè¡¨çš„æ•°æ®ï¼š
- [ ] t_sys_user (1 æ¡è®°å½•)
- [ ] t_sys_robot (1 æ¡è®°å½•)
- [ ] t_biz_target (1 æ¡è®°å½•)
- [ ] t_biz_task (1 æ¡è®°å½•)
- [ ] t_sys_log (1 æ¡è®°å½•)

---

## ğŸ¯ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

### åœæ­¢æœåŠ¡å™¨
```bash
Ctrl + C
```

### é‡å¯æœåŠ¡å™¨
```bash
python3 main.py
```

### é‡ç½®æ•°æ®åº“
```bash
python3 init_all.py
```

### æŸ¥çœ‹æ—¥å¿—
```bash
python3 view_data.py
```

### æµ‹è¯•ç¯å¢ƒ
```bash
python3 test_connection.py
```

---

## ğŸ“š å¸®åŠ©æ–‡æ¡£

- **å¿«é€Ÿå¼€å§‹**: æŸ¥çœ‹ `QUICKSTART.md`
- **è¯¦ç»†æ–‡æ¡£**: æŸ¥çœ‹ `README.md`
- **ä¸­æ–‡è¯´æ˜**: æŸ¥çœ‹ `ä½¿ç”¨è¯´æ˜.md`

---

## âœ¨ æˆåŠŸæç¤º

å½“ä½ çœ‹åˆ°ä»¥ä¸‹ç”»é¢æ—¶ï¼Œè¯´æ˜ç³»ç»Ÿè¿è¡ŒæˆåŠŸï¼š

1. ç»ˆç«¯æ˜¾ç¤ºï¼š`INFO: Uvicorn running on http://0.0.0.0:8000`
2. æµè§ˆå™¨è®¿é—® http://localhost:8000 æ˜¾ç¤ºæ¼‚äº®çš„ç•Œé¢
3. ç»Ÿè®¡æ•°æ®æ­£å¸¸æ˜¾ç¤ºï¼ˆåœ¨çº¿è®¾å¤‡ã€ä»»åŠ¡è¿›åº¦ç­‰ï¼‰
4. åœ°å›¾ä¸Šæœ‰æœºå™¨äººå’Œæœå®å›¾æ ‡

**æ­å–œï¼ç³»ç»Ÿå·²æˆåŠŸè¿è¡Œï¼** ğŸ‰

---

## ğŸ”„ æ—¥å¸¸ä½¿ç”¨

### æ¯æ¬¡å¯åŠ¨ç³»ç»Ÿ
```bash
cd /home/anders/citrus_web_backend
python3 main.py
```

### æ·»åŠ æ–°æ•°æ®
ç¼–è¾‘ `populate_data.py`ï¼Œç„¶åè¿è¡Œï¼š
```bash
python3 populate_data.py
```

### æŸ¥çœ‹å½“å‰æ•°æ®
```bash
python3 view_data.py
```

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼**
